# BUG-017: RH não tem acesso ao menu Usuários apesar de ter permissões users:*

## Informações
- **Data:** 15/01/2026
- **Teste:** RH-AUX-002, RH-GER-002
- **Usuário Testado:** Auxiliar RH, Gerente RH
- **Executor:** Sistema automatizado
- **Severidade:** CRÍTICA

## Comportamento Esperado
O departamento de RH é responsável pela gestão de usuários do sistema. Segundo as permissões definidas em `permissions.ts`:

- Auxiliar RH: `users:read`
- Gerente RH: `users:read`, `users:create`, `users:update`, `users:delete`, `settings:read`

Portanto, usuários do RH deveriam ter acesso ao menu "Usuários" para realizar suas funções.

## Comportamento Atual
O menu "Usuários" só é visível para usuários com `admin:all`, conforme implementado em `app-sidebar.tsx`:

```typescript
const menuItems: MenuItem[] = [
  // ...
  {
    title: "Usuários",
    href: "/usuarios",
    icon: Users,
    requireAdmin: true, // <- Requer admin:all, ignora users:read/create/update/delete
  },
];
```

Resultado: **O RH não consegue acessar a gestão de usuários**, que é sua principal função!

## Análise da Causa
Há uma inconsistência completa entre:
1. **Permissões definidas**: RH tem permissões específicas de usuários
2. **UI implementada**: Menu Usuários requer `admin:all` via `RequireAdmin`

O sistema de permissões granulares (`users:read`, `users:create`, etc.) foi implementado no código mas não está sendo utilizado para controlar a visibilidade do menu.

## Arquivos Afetados
- `apps/web/src/components/layout/app-sidebar.tsx`
- `apps/web/src/lib/auth/permissions.ts`

## Correção Sugerida

### Opção A: Usar RequirePermission no sidebar
```typescript
const menuItems: MenuItem[] = [
  {
    title: "Usuários",
    href: "/usuarios",
    icon: Users,
    requirePermission: ['users:read', 'admin:all'], // Qualquer uma
    permissionMode: 'any',
  },
];
```

### Opção B: Criar componente específico para RH
```typescript
// Para itens que requerem permissões específicas
if (item.requirePermission) {
  return (
    <RequirePermission permission={item.requirePermission} mode={item.permissionMode || 'any'}>
      {menuItemElement}
    </RequirePermission>
  );
}
```

## Impacto
- **CRÍTICO**: Todo o departamento de RH não consegue realizar suas funções principais
- Afeta todos os cargos do RH: Auxiliar, Assistente, Analista Jr/Pl/Sr, Supervisor, Gerente
- A gestão de usuários só pode ser feita por Admins/Diretores/Desenvolvedores

## Observações
Este bug torna o departamento de RH **completamente inoperante** para sua função principal de gerenciamento de pessoas. Deve ser corrigido com alta prioridade.

Considerando que BUG-015 também afeta o RH (5 cargos sem permissões), **todo o departamento de RH está inutilizável**.
