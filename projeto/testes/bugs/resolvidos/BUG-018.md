# BUG-018: Gerente Comercial não consegue acessar página de Unidades

## Informações
- **Data:** 15/01/2026
- **Teste:** COM-GER-003
- **Usuário Testado:** Gerente Comercial
- **Executor:** Sistema Automatizado (Playwright MCP)

## Comportamento Esperado
O Gerente Comercial possui a permissão `units:read` definida no código (`permissions.ts`). Ao clicar no menu "Unidades" ou acessar diretamente a URL `/unidades`, a página de lista de unidades deveria carregar normalmente.

## Comportamento Atual
- O menu "Unidades" está **visível** no sidebar (teste COM-GER-002 passou ✅)
- Porém, ao clicar no menu ou acessar diretamente `/unidades`, o usuário é **redirecionado automaticamente para o Dashboard**
- A página de unidades não carrega para o Gerente Comercial

## Passos para Reproduzir
1. Login como admin (admin@garageinn.com.br)
2. Ir para Usuários (/usuarios)
3. Filtrar por departamento "Comercial"
4. Clicar em "Abrir menu" no usuário "Teste Gerente - Comercial"
5. Clicar em "Personificar"
6. Confirmar a personificação
7. Clicar no menu "Unidades" no sidebar
8. **Resultado:** Redirecionado para Dashboard em vez de carregar /unidades

## Evidências
- URL tentada: `http://localhost:3001/unidades`
- URL resultante após redirecionamento: `http://localhost:3001/dashboard`
- Menu "Unidades" está visível no sidebar (confirmado)
- Permissão `units:read` está definida para Gerente Comercial em `permissions.ts`

## Análise Técnica
O problema pode estar em um dos seguintes pontos:
1. **Middleware de autorização**: Pode não estar verificando corretamente a permissão `units:read` para a rota `/unidades`
2. **Componente de proteção de rota**: Pode estar verificando uma permissão diferente (ex: `units:*` ou `admin:all`)
3. **RLS no Supabase**: A query de unidades pode estar retornando vazio e causando redirect

### Verificar:
- `apps/web/src/middleware.ts` - verificar regras de redirecionamento
- `apps/web/src/app/(authenticated)/unidades/page.tsx` - verificar guards de permissão
- Políticas RLS da tabela `units` - verificar se permite leitura para usuários com `units:read`

## Severidade
**MÉDIA** - O usuário consegue ver o menu, indicando que deveria ter acesso. O redirecionamento silencioso pode causar confusão e frustração.

## Observações
- O mesmo comportamento NÃO ocorre com a página de Chamados (carrega normalmente)
- O mesmo comportamento NÃO ocorre com a página de Checklists (carrega normalmente)
- O problema parece específico da rota `/unidades`
